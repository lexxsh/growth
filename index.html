<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>음성 인식 날짜 비교</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="apikey.js"></script>
    <script src="script.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jua&display=swap"
      rel="stylesheet"
    />
    <style>
       * {
        padding: 0;
        margin: 0;
      }
      body {
        font-family: "Jua", sans-serif;
        height: 932px;
        width: 430px;
        background-color: #f9f5f0;
      }
      .container {
        margin-top: 50px;
      }
      .stt-start-button {
        background-color: transparent;
        border: none;
      }
      .stt-stop-button {
        background-color: transparent;
        border: none;
      }
      .text-center {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .tr {
        display: flex;
        flex-direction: row;
        text-align: center;
        justify-content: center;
        gap: 10px;
        font-size: 20px;
      }
      .th {
        border: 1px solid;
        border-radius: 30px;
        background-color: #0061f3 !important;
        color: white;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
      }
      .table1 {
        display: flex;
        justify-content: center;

        width: 360px;
        height: 500px;
        background-color: white;
        border-radius: 15px;
      }
      .table2 {
        display: flex;
        justify-content: center;

        width: 360px;
        height: auto;
        background-color: white;
        border-radius: 15px;
      }
      .pic {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .form-control {
        width: 300px;
        min-height: 53px; /* 최소 높이를 설정하고 */
        height: auto; /* 높이를 자동으로 조정 */
        overflow: hidden; /* 넘치는 내용이 보이지 않도록 설정 */
        background-color: white !important;
        border-radius: 35px;
        border: none;
        box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
      }
      .thead {
        display: flex;
        flex-direction: column;
      }
      .btn {
        background-color: #00ba34;
        height: 53px;
        width: 53px;
        border-radius: 18px;
      }
      .center {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .All {
        display: flex;
        flex-direction: column;
        margin-top: 30px;
        justify-content: center;
        align-items: center;
      }
      .text11 {
        background-color: rgba(0, 97, 243, 0.3);
        border-radius: 30px;
        border: 2px solid rgba(0, 97, 243, 0.5);
      }
    </style>
  </head>
  <body>
    <div class="All">
      <div class="text-center">
        <div>
          <button class="stt-start-button" id="stt-start-button">
            <svg
              width="100"
              height="100"
              viewBox="0 0 100 100"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="50" cy="50" r="50" fill="white" />
              <path
                d="M50 57.8947C47.0238 57.8947 44.494 56.9737 42.4107 55.1316C40.3274 53.2895 39.2857 51.0526 39.2857 48.4211V29.4737C39.2857 26.8421 40.3274 24.6053 42.4107 22.7632C44.494 20.9211 47.0238 20 50 20C52.9762 20 55.506 20.9211 57.5893 22.7632C59.6726 24.6053 60.7143 26.8421 60.7143 29.4737V48.4211C60.7143 51.0526 59.6726 53.2895 57.5893 55.1316C55.506 56.9737 52.9762 57.8947 50 57.8947ZM46.4286 80V70.2895C40.2381 69.5526 35.119 67.1053 31.0714 62.9474C27.0238 58.7895 25 53.9474 25 48.4211H32.1429C32.1429 52.7895 33.8839 56.5132 37.3661 59.5921C40.8482 62.6711 45.0595 64.2105 50 64.2105C54.9405 64.2105 59.1518 62.6711 62.6339 59.5921C66.1161 56.5132 67.8571 52.7895 67.8571 48.4211H75C75 53.9474 72.9762 58.7895 68.9286 62.9474C64.881 67.1053 59.7619 69.5526 53.5714 70.2895V80H46.4286ZM50 51.5789C51.0119 51.5789 51.8601 51.2763 52.5446 50.6711C53.2292 50.0658 53.5714 49.3158 53.5714 48.4211V29.4737C53.5714 28.5789 53.2292 27.8289 52.5446 27.2237C51.8601 26.6184 51.0119 26.3158 50 26.3158C48.9881 26.3158 48.1399 26.6184 47.4554 27.2237C46.7708 27.8289 46.4286 28.5789 46.4286 29.4737V48.4211C46.4286 49.3158 46.7708 50.0658 47.4554 50.6711C48.1399 51.2763 48.9881 51.5789 50 51.5789Z"
                fill="#0061F3"
              />
            </svg>
          </button>
        </div>
        <div>
          <button class="stt-stop-button" id="stt-stop-button">
            <svg
              width="100"
              height="100"
              viewBox="0 0 100 100"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="50" cy="50" r="50" fill="white" />
              <path
                d="M50 57.8947C47.0238 57.8947 44.494 56.9737 42.4107 55.1316C40.3274 53.2895 39.2857 51.0526 39.2857 48.4211V29.4737C39.2857 26.8421 40.3274 24.6053 42.4107 22.7632C44.494 20.9211 47.0238 20 50 20C52.9762 20 55.506 20.9211 57.5893 22.7632C59.6726 24.6053 60.7143 26.8421 60.7143 29.4737V48.4211C60.7143 51.0526 59.6726 53.2895 57.5893 55.1316C55.506 56.9737 52.9762 57.8947 50 57.8947ZM46.4286 80V70.2895C40.2381 69.5526 35.119 67.1053 31.0714 62.9474C27.0238 58.7895 25 53.9474 25 48.4211H32.1429C32.1429 52.7895 33.8839 56.5132 37.3661 59.5921C40.8482 62.6711 45.0595 64.2105 50 64.2105C54.9405 64.2105 59.1518 62.6711 62.6339 59.5921C66.1161 56.5132 67.8571 52.7895 67.8571 48.4211H75C75 53.9474 72.9762 58.7895 68.9286 62.9474C64.881 67.1053 59.7619 69.5526 53.5714 70.2895V80H46.4286ZM50 51.5789C51.0119 51.5789 51.8601 51.2763 52.5446 50.6711C53.2292 50.0658 53.5714 49.3158 53.5714 48.4211V29.4737C53.5714 28.5789 53.2292 27.8289 52.5446 27.2237C51.8601 26.6184 51.0119 26.3158 50 26.3158C48.9881 26.3158 48.1399 26.6184 47.4554 27.2237C46.7708 27.8289 46.4286 28.5789 46.4286 29.4737V48.4211C46.4286 49.3158 46.7708 50.0658 47.4554 50.6711C48.1399 51.2763 48.9881 51.5789 50 51.5789Z"
                fill="#0061F3"
              />
            </svg>
          </button>
          <p id="status-stop-text">음성중지하기</p>
          <p id="message" class="text-center mt-3">버튼을 누르고 말씀하세요.</p>
        </div>
      </div>
      <div class="center">
        <form id="stt-form" class="mt-3">
          <div class="mb-3">
            <textarea
              name="content"
              class="form-control"
              id="text-area"
              readonly
            ></textarea>
          </div>
        </form>
        <button id="add-button" class="btn" type="button">
          <img src="im3.png" alt="플라쓰" style="width: 90%" />
        </button>
      </div>
      <div>
        <div class="table1" id="dateTable">
          <div class="thead">
            <div class="tr">
              <div class="th" style="width: 90px">품목</div>
              <div class="th" style="width: 115px">소비기한</div>
              <div class="th" style="width: 90px">D-Day</div>
            </div>
            <div>
              <svg
                width="360"
                height="2"
                viewBox="0 0 360 2"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <line
                  y1="1"
                  x2="360"
                  y2="1"
                  stroke="#0061F3"
                  stroke-width="2"
                  stroke-dasharray="3 3"
                />
              </svg>
            </div>
            <div class="thead">
              <div class="tr">
                <div id="text-part" class="text11" style="width: 90px">
                  달걀
                </div>
                <div id="date-part" style="width: 115px"></div>
                <div id="d-day-part" style="width: 90px"></div>
              </div>
            </div>
            <div class="pic">
              <img
                src="img.png"
                id="img"
                alt="냉장고"
                style="width: 90%; margin-top: 40px"
              />
              <img
                src="img2.png"
                id="img1"
                alt="냉장고글짜"
                style="width: 90%; margin-top: 20px"
              />
            </div>
          </div>

          <div class="tbody" id="dateTableBody"></div>
        </div>
        <div class="container mt-3">
          <h2>오늘 날짜</h2>
          <table class="table">
            <thead>
              <tr>
                <th>현재 날짜</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="current-date-cell"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="table2" id="table2">
          <div id="loading">Loading...</div>
          <div id="result"></div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        updateCurrentDate();
        setMidnightUpdate();
      });

      function updateCurrentDate() {
        const currentDate = new Date();
        const currentDateFormatted = currentDate.toLocaleDateString("ko-KR");
        document.getElementById("current-date-cell").innerText =
          currentDateFormatted;
      }

      function setMidnightUpdate() {
        const now = new Date();
        const night = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate() + 1,
          0,
          0,
          0
        );
        const msToMidnight = night.getTime() - now.getTime();

        setTimeout(() => {
          updateCurrentDate();
          setMidnightUpdate();
        }, msToMidnight);
      }

      const stt_start_button = document.querySelector("#stt-start-button");
      const stt_stop_button = document.querySelector("#stt-stop-button");
      const stt_start_text = document.querySelector("#status-start-text");
      const stt_stop_text = document.querySelector("#status-stop-text");
      const img = document.querySelector("#img");
      const img1 = document.querySelector("#img1");
      const add_button = document.querySelector("#add-button");
      const message = document.querySelector("#message");
      const content_field = document.querySelector("#stt-form [name=content]");
      const dateTableBody = document.querySelector("#dateTableBody");
      let lastTranscript = "";
      const table1 = document.querySelector("#table2");
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      const speech_recognition = new SpeechRecognition();
      speech_recognition.lang = "ko-kr";
      speech_recognition.continuous = true;
      stt_stop_button.classList.add("d-none");
      stt_stop_text.classList.add("d-none");
      stt_start_button.addEventListener("click", (e) => {
        e.preventDefault();
        enable_stt();
      });

      stt_stop_button.addEventListener("click", (e) => {
        e.preventDefault();
        disable_stt();
      });

      function enable_stt() {
        stt_stop_button.classList.remove("d-none");
        stt_stop_text.classList.remove("d-none");
        stt_start_button.classList.add("d-none");
        speech_recognition.start();
        message.innerHTML = "음성인식 중...";
      }

      function disable_stt() {
        stt_start_button.classList.remove("d-none");
        stt_stop_button.classList.add("d-none");
        stt_stop_text.classList.add("d-none");
        speech_recognition.stop();
        message.innerHTML = "버튼을 누르고 말씀하세요.";
      }

      speech_recognition.onresult = function (e) {
        lastTranscript = Array.from(e.results)
          .map((result) => result[0])
          .map((speech) => speech.transcript)
          .join(" ");
        content_field.value = lastTranscript;
      };

      speech_recognition.onerror = function (e) {
        console.error(e);
        disable_stt();
      };

      const addButton = document.querySelector("#add-button");
      addButton.addEventListener("click", function () {
        const textArea = document.querySelector("#text-area");
        const textPart = document.querySelector("#text-part");
        const datePart = document.querySelector("#date-part");

        // 한글 텍스트와 숫자 날짜를 분리
        const content = textArea.value;
        const regex = /([가-힣]+)[, ]+(\d{8})\./;
        const matches = content.match(regex);

        if (matches) {
          img.classList.add("d-none");
          img1.classList.add("d-none");
          const text = matches[1]; // 한글 텍스트
          const dateString = matches[2]; // 날짜 숫자 문자열

          // 텍스트 파트에 텍스트 저장
          const newTextElement = document.createElement("div");
          newTextElement.textContent = text;
          textPart.appendChild(newTextElement);
          // 콘솔에 텍스트 출력
          console.log("저장된 텍스트:", text);

          // 날짜를 YYYY.MM.DD 형식으로 변환
          const year = dateString.slice(0, 4);
          const month = dateString.slice(4, 6);
          const day = dateString.slice(6, 8);
          const formattedDate = `${year}.${month}.${day}`;

          // 날짜 파트에 날짜 저장
          const newDateElement = document.createElement("div");
          newDateElement.textContent = formattedDate;
          datePart.appendChild(newDateElement);
          // 콘솔에 날짜 출력
          console.log("저장된 날짜:", formattedDate);
        } else {
          // 경고 메시지 표시
          console.log('입력 형식이 잘못되었습니다. 예시: "텍스트, 20240101."');
        }
      });
    </script>
  </body>
</html>
